<section class="section mt-6">
  <div class="container">
    <div class="columns is-centered">
      <div class="column is-5">
        <div class="card mb-6">
          <header class="card-header">
            <p class="card-header-title">
              <%= @whiskey.name %>
            </p>
            <span>レビュー数<%= @whiskey.reviews.count %></span>
            <div class="col-sm-6">
					 		<% if @whiskey.image? %>
					 			<%= image_tag @whiskey.image.to_s, size:'400x400' %>
					    <% else %>
					      <%= image_tag "no_image.jpg", size:'400x400' %>    
					    <% end %>
			  		</div>
         	</header>
          <div class="card-content">
            <div class="content average-score">
              <div class="star-rating mb-2">
                <div class="star-rating-front" style="width: %">★★★★★</div>
                <div class="star-rating-back">★★★★★</div>
              </div>
              <div class="average-score-display ml-3 pt-2">
                点（<%= @whiskey.reviews.count %>件のレビュー）
              </div>              
            </div>
						<div>
							<ul>
					 			<li>種別: <%= @whiskey.genre.genre%></li>
								<li>産地: <%= @whiskey.district.district %></li>
								<li>購入価格: ¥<%= @whiskey.price %></li>
								<li class="info"><%= @whiskey.body %></li>
								<% if current_user = @whiskey.user %>
									<li><%= link_to "削除", whiskeys_path, method: :delete %></li>
								<% end %>
							</ul>
					 	</div>
          </div>
        </div>
        <div class="col-sm-12">
        	<%# data-scoreに先ほど設定した@average_reviewのインスタンス変数を当てる。 %>
					<div class="average-review-rating" data-score=<%= @average_review %> >平均スコア</div>
					<script>
					  $('.average-review-rating').raty({
					    readOnly: true,
					    path: '/assets/',
					    score: function() {
					      return $(this).attr('data-score')
					    }
					  });
					</script>     
					<div class="rating-box mt-3">
				    <%= form_for ([@whiskey, @whiskey.reviews.build]) do |f| %>
						  <div id="rating-form">
						    <label>評価</label>
						  </div>
						  <%= f.text_field :content %>
						  <%= f.submit "保存", class: "button mt-3" %>
						  <%= link_to "他のレビューを見る", whiskey_reviews_path(@whiskey), class: "button light ml-3 mt-3" %>
						<% end %>

						<script>
						  $('#rating-form').raty({
						    path: '/assets/',
						    scoreName: 'review[rating]'
						  });
						</script>
					</div>					
				</div>
      </div>
    </div>
  </div>
</section>

<script>
  $('.review-rating').raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    path: '/assets/'
  });
</script>






